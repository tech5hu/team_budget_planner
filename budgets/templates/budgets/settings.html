{% extends 'budgets/index.html' %}
{% load static %}

<head>
    <!-- Link to static CSS file -->
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
</head>

{% block content %}
    <h2>Account Settings</h2>

    <!-- Change Password -->
    <section class="settings-section">
        <h3>Change Password</h3>
        <form method="post" action="{% url 'budgets:change_password' %}">
            {% csrf_token %}
            <div class="form-group">
                <label for="current_password">Current Password</label>
                <input type="password" id="current_password" name="current_password" required>
            </div>
            <div class="form-group">
                <label for="new_password">New Password</label>
                <input type="password" id="new_password" name="new_password" required>
            </div>
            <div class="form-group">
                <label for="confirm_password">Confirm New Password</label>
                <input type="password" id="confirm_password" name="confirm_password" required>
            </div>
            <button type="submit" class="btn btn-primary">Change Password</button>
        </form>
    </section>

    <!-- Notification Settings -->
    <section class="settings-section">
        <h3>Notification Preferences</h3>
        <form method="post" action="{% url 'budgets:update_notifications' %}">
            {% csrf_token %}
            <div class="form-group">
                <label for="email_notifications">Email Notifications</label>
                <input type="checkbox" id="email_notifications" name="email_notifications" {% if user.teammember.email_notifications %}checked{% endif %}>
            </div>
            <div class="form-group">
                <label for="sms_notifications">SMS Notifications</label>
                <input type="checkbox" id="sms_notifications" name="sms_notifications" {% if user.teammember.sms_notifications %}checked{% endif %}>
            </div>
            <button type="submit" class="btn btn-primary">Save Notification Settings</button>
        </form>
    </section>

    {% if user.is_manager %}
        <!-- Username and Email Update for Managers -->
        <section class="settings-section">
            <h3>Account Details</h3>
            <form method="post" action="{% url 'budgets:update_account_details' %}">
                {% csrf_token %}
                <div class="form-group">
                    <label for="username">Username</label>
                    <input type="text" id="username" name="username" value="{{ user.username }}" required>
                </div>
                <div class="form-group">
                    <label for="email">Email</label>
                    <input type="email" id="email" name="email" value="{{ user.email }}" required>
                </div>
                <button type="submit" class="btn btn-primary">Update Account Details</button>
            </form>
        </section>

        <!-- Account Deletion -->
        <section class="settings-section">
            <h3>Delete Account</h3>
            <form method="post" action="{% url 'budgets:delete_account' %}">
                {% csrf_token %}
                <p>Deleting your account is permanent and cannot be undone. All your data will be lost.</p>
                <button type="submit" class="btn btn-danger">Delete Account</button>
            </form>
        </section>
    {% endif %}
{% endblock %}
